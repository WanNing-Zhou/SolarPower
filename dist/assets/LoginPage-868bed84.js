import{d as C,r as c,o as N,w as U,c as L,a as r,u as q,b as l,e as B,f as o,g as w,h as p,s as E,E as g,p as M,i as P,_ as R}from"./index-fd38cc11.js";import{l as J,g as O}from"./user-8ed530fc.js";const T=d=>(M("data-v-73b1fd2e"),d=d(),P(),d),$=T(()=>w("h1",null,"登录",-1)),z={class:"flex"},A=C({__name:"LoginPage",setup(d){const v=c(!1),m=c(!1),s=c({username:"",password:"",repassword:""});N(()=>{const a=localStorage.getItem("acc-form");if(a){m.value=!0;const e=JSON.parse(a);s.value.username=e.username,s.value.password=atob(e.password)}});const i=c(),b={username:[{required:!0,message:"用户名不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"},{pattern:/^\S{5,15}$/,message:"密码必须是5-15位的非空字符",trigger:"blur"}],repassword:[{required:!0,message:"密码不能为空",trigger:"blur"},{pattern:/^\S{5,15}$/,message:"密码必须是5-15位的非空字符",trigger:"blur"},{validator:(a,e)=>{a!==s.value.password?e(new Error("两次输入的密码不一致")):e()},trigger:"blur"}]},_=q(),h=async()=>{var a;if(m.value){const e=JSON.stringify({password:btoa(s.value.password),username:s.value.username});localStorage.setItem("acc-form",e)}else localStorage.removeItem("acc-form");try{await i.value.validate();const e=await J({username:s.value.username,password:s.value.password});e.data&&E(e.data);const n=await O();console.log(n);const{isAdmin:t}=(a=n==null?void 0:n.data)==null?void 0:a.permission;t?_.push("/admin"):_.push("/home"),g.success("登录成功")}catch(e){g.error(e)}},x=a=>{console.log("remember",a),a=!0};return U(v,()=>{s.value={username:"",password:"",repassword:""}}),(a,e)=>{const n=l("el-col"),t=l("el-form-item"),f=l("el-input"),y=l("el-checkbox"),V=l("el-link"),S=l("el-button"),k=l("el-form"),I=l("el-row");return B(),L(I,{class:"login-page"},{default:r(()=>[o(n,{span:14,class:"bg"}),o(n,{span:10,class:"form"},{default:r(()=>[o(k,{ref_key:"form",ref:i,model:s.value,rules:b,size:"large",autocomplete:"off",style:{width:"30%"}},{default:r(()=>[o(t,null,{default:r(()=>[$]),_:1}),o(t,{prop:"username"},{default:r(()=>[o(f,{"prefix-icon":"User",modelValue:s.value.username,"onUpdate:modelValue":e[0]||(e[0]=u=>s.value.username=u),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),o(t,{prop:"password"},{default:r(()=>[o(f,{name:"password","prefix-icon":"Lock",type:"password",modelValue:s.value.password,"onUpdate:modelValue":e[1]||(e[1]=u=>s.value.password=u),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),o(t,{class:"flex"},{default:r(()=>[w("div",z,[o(y,{modelValue:m.value,"onUpdate:modelValue":e[2]||(e[2]=u=>m.value=u),onChange:x},{default:r(()=>[p("记住我")]),_:1},8,["modelValue"]),o(V,{type:"primary",underline:!1},{default:r(()=>[p("忘记密码？")]),_:1})])]),_:1}),o(t,null,{default:r(()=>[o(S,{class:"button",type:"primary",onClick:h,"auto-insert-space":""},{default:r(()=>[p("登录")]),_:1})]),_:1}),o(t,{class:"flex"})]),_:1},8,["model"])]),_:1})]),_:1})}}});const D=R(A,[["__scopeId","data-v-73b1fd2e"]]);export{D as default};
