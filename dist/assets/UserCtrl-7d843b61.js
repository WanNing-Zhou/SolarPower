import{d as x,n as k,r as w,w as D,c as E,a as l,b as r,e as $,f as e,h as g,g as h,E as A,v as I,A as B,j as S,u as T}from"./index-313e5491.js";import{a as N,g as z,b as F,c as O,d as j}from"./suer-3d73a000.js";import{a as L}from"./findDataUtils-7343f3bc.js";const M=h("div",null,"编辑用户",-1),P=x({__name:"EditUserDialog",props:{visible:{type:Boolean},user:{}},emits:["update:visible"],setup(U,{emit:V}){const u=U,m=V,f=k({get(){return u.visible},set(){m("update:visible",!1)}}),a=w({...{username:"",password:"",concat:"",contact:"",address:""}}),_=k(()=>u.user);D(_,()=>{console.log("触发了"),a.value={...u.user}},{deep:!0,immediate:!0});const v=async()=>{try{(await N(a.value)).code===200&&A.success("添加成功")}catch{}},p=()=>{m("update:visible",!1)};return(d,o)=>{const n=r("el-input"),t=r("el-form-item"),s=r("el-button"),i=r("el-form"),b=r("el-dialog");return $(),E(b,{modelValue:f.value,"onUpdate:modelValue":o[4]||(o[4]=c=>f.value=c)},{title:l(()=>[M]),default:l(()=>[e(i,{"label-position":"right","label-width":"80px",model:a.value},{default:l(()=>[e(t,{label:"账号"},{default:l(()=>[e(n,{modelValue:a.value.username,"onUpdate:modelValue":o[0]||(o[0]=c=>a.value.username=c)},null,8,["modelValue"])]),_:1}),e(t,{label:"联系电话"},{default:l(()=>[e(n,{modelValue:a.value.contact,"onUpdate:modelValue":o[1]||(o[1]=c=>a.value.contact=c)},null,8,["modelValue"])]),_:1}),e(t,{label:"登录密码"},{default:l(()=>[e(n,{modelValue:a.value.password,"onUpdate:modelValue":o[2]||(o[2]=c=>a.value.password=c)},null,8,["modelValue"])]),_:1}),e(t,{label:"地址"},{default:l(()=>[e(n,{modelValue:a.value.address,"onUpdate:modelValue":o[3]||(o[3]=c=>a.value.address=c)},null,8,["modelValue"])]),_:1}),e(t,null,{default:l(()=>[e(s,{type:"primary",onClick:v},{default:l(()=>[g("提交")]),_:1}),e(s,{type:"info",onClick:p},{default:l(()=>[g("取消")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),R=h("div",{class:"my-header"}," 授权管理 ",-1),q={style:{"min-height":"300px"}},G=x({__name:"AuthDialog",props:{visible:{type:Boolean},user:{}},emits:["update:visible","success"],setup(U,{emit:V}){const u=U,m=V,f=w({userId:"",stationIds:[]}),y={multiple:!0},a=w([]),_=async()=>{const t=(await z()).data.map(s=>{const i=((s==null?void 0:s.stations)||[]).map(b=>({value:b.id,label:b.name}));return{value:s.id,label:s.name,children:i}});a.value=t};_();const v=w([]);D(v,(n,t)=>{const s=[];v.value.forEach(i=>{i[1]&&s.push(i[1])}),f.value.stationIds=s}),D(u,async()=>{var n;if((n=u==null?void 0:u.user)!=null&&n.id&&u.visible){f.value.userId=u.user.id,a.value.length||await _();const t=u.user.permission.stationIds;v.value=L(t,a.value)}});const p=k({get(){return u.visible},set(){m("update:visible",!1)}}),d=()=>{m("update:visible",!1)},o=async()=>{(await F(f.value)).code==200&&(A.success("修改成功"),m("update:visible",!1),m("success"))};return(n,t)=>{const s=r("el-form-item"),i=r("el-cascader"),b=r("el-form"),c=r("el-button"),H=r("el-dialog");return $(),E(H,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=C=>p.value=C),"show-close":!1,width:"500"},{header:l(()=>[R]),footer:l(()=>[h("div",null,[e(c,{type:"primary",onClick:o},{default:l(()=>[g("确认")]),_:1}),e(c,{type:"primary",onClick:d},{default:l(()=>[g("重置")]),_:1})])]),default:l(()=>[h("div",q,[e(b,null,{default:l(()=>[e(s,{label:"用户名"},{default:l(()=>[g(I(n.user.username),1)]),_:1}),e(s,{label:"站点权限"},{default:l(()=>[e(i,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=C=>v.value=C),rows:2,props:y,options:a.value,"show-all-levels":!1},null,8,["modelValue","options"])]),_:1}),e(s)]),_:1})])]),_:1},8,["modelValue"])}}}),J={class:"user-ctrl-page"},K=h("div",{class:"page-header"},"用户管理",-1),Q={class:"option-row"},Z=x({__name:"UserCtrl",setup(U){w({username:"",name:"",phone:""});const V=w([]),u=T(),m=async()=>{const d=(await O()).data.filter(o=>!o.permission.isAdmin);V.value=d};m();const f=()=>{u.push({path:"/admin/create-user"})},y=B({visible:!1,data:{}}),a=async p=>{try{console.log(p.id),await j(p.id),await m(),A.success("删除成功")}catch{}},_=B({visible:!1,data:null}),v=p=>{_.visible=!0,_.data=p};return(p,d)=>{const o=r("el-divider"),n=r("el-button"),t=r("el-table-column"),s=r("el-table");return $(),S("div",J,[K,e(o),h("div",Q,[e(n,{type:"primary",onClick:f},{default:l(()=>[g("新建用户")]),_:1})]),e(s,{data:V.value,style:{width:"100%"}},{default:l(()=>[e(t,{prop:"username",label:"账号"}),e(t,{prop:"contact",label:"联系电话"}),e(t,{prop:"address",label:"地址"}),e(t,{label:"操作",width:"280"},{default:l(i=>[e(n,{size:"small",onClick:b=>v(i.row)},{default:l(()=>[g("授权管理")]),_:2},1032,["onClick"]),e(n,{size:"small",type:"danger",onClick:b=>a(i.row)},{default:l(()=>[g("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(P,{visible:y.visible,"onUpdate:visible":d[0]||(d[0]=i=>y.visible=i),user:y.data},null,8,["visible","user"]),e(G,{visible:_.visible,"onUpdate:visible":d[1]||(d[1]=i=>_.visible=i),user:_.data,onSuccess:m},null,8,["visible","user"])])}}});export{Z as default};
