import{d as x,l as C,r as V,w as D,c as A,a as l,b as d,o as $,e,g,f as h,E as B,t as I,z as E,i as S,u as T}from"./index-885010f6.js";import{a as z,g as N,b as F,c as O,d as L}from"./suer-a4f6e5f0.js";import{a as M}from"./findDataUtils-7343f3bc.js";const P=h("div",null,"编辑用户",-1),R=x({__name:"EditUserDialog",props:{visible:{type:Boolean},user:{}},emits:["update:visible"],setup(k,{emit:y}){const u=k,m=y,f=C({get(){return u.visible},set(){m("update:visible",!1)}}),a=V({...{username:"",password:"",concat:"",contact:"",address:""}}),_=C(()=>u.user);D(_,()=>{console.log("触发了"),a.value={...u.user}},{deep:!0,immediate:!0});const v=async()=>{try{(await z(a.value)).code===200&&B.success("添加成功")}catch{}},p=()=>{m("update:visible",!1)};return(r,o)=>{const n=d("el-input"),t=d("el-form-item"),s=d("el-button"),i=d("el-form"),b=d("el-dialog");return $(),A(b,{modelValue:f.value,"onUpdate:modelValue":o[4]||(o[4]=c=>f.value=c)},{title:l(()=>[P]),default:l(()=>[e(i,{"label-position":"right","label-width":"80px",model:a.value},{default:l(()=>[e(t,{label:"账号"},{default:l(()=>[e(n,{modelValue:a.value.username,"onUpdate:modelValue":o[0]||(o[0]=c=>a.value.username=c)},null,8,["modelValue"])]),_:1}),e(t,{label:"联系电话"},{default:l(()=>[e(n,{modelValue:a.value.contact,"onUpdate:modelValue":o[1]||(o[1]=c=>a.value.contact=c)},null,8,["modelValue"])]),_:1}),e(t,{label:"登录密码"},{default:l(()=>[e(n,{modelValue:a.value.password,"onUpdate:modelValue":o[2]||(o[2]=c=>a.value.password=c)},null,8,["modelValue"])]),_:1}),e(t,{label:"地址"},{default:l(()=>[e(n,{modelValue:a.value.address,"onUpdate:modelValue":o[3]||(o[3]=c=>a.value.address=c)},null,8,["modelValue"])]),_:1}),e(t,null,{default:l(()=>[e(s,{type:"primary",onClick:v},{default:l(()=>[g("提交")]),_:1}),e(s,{type:"info",onClick:p},{default:l(()=>[g("取消")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),j=h("div",{class:"my-header"}," 授权管理 ",-1),q={style:{"min-height":"300px"}},G=x({__name:"AuthDialog",props:{visible:{type:Boolean},user:{}},emits:["update:visible","success"],setup(k,{emit:y}){const u=k,m=y,f=V({userId:"",stationIds:[]}),w={multiple:!0},a=V([]),_=async()=>{const t=(await N()).data.map(s=>{const i=((s==null?void 0:s.stations)||[]).map(b=>({value:b.id,label:b.name}));return{value:s.id,label:s.name,children:i}});a.value=t};_();const v=V([]);D(v,(n,t)=>{const s=[];v.value.forEach(i=>{i[1]&&s.push(i[1])}),f.value.stationIds=s}),D(u,async()=>{var n;if((n=u==null?void 0:u.user)!=null&&n.id&&u.visible){f.value.userId=u.user.id,a.value.length||await _();const t=u.user.permission.stationIds;v.value=M(t,a.value)}}),V(["kakxi","kakdong"]);const p=C({get(){return u.visible},set(){m("update:visible",!1)}}),r=()=>{m("update:visible")},o=async()=>{(await F(f.value)).code==200&&(B.success("修改成功"),m("update:visible",!1),m("success"))};return(n,t)=>{const s=d("el-form-item"),i=d("el-cascader"),b=d("el-form"),c=d("el-button"),H=d("el-dialog");return $(),A(H,{modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=U=>p.value=U),"show-close":!1,width:"500"},{header:l(()=>[j]),footer:l(()=>[h("div",null,[e(c,{type:"primary",onClick:o},{default:l(()=>[g("确认")]),_:1}),e(c,{type:"primary",onClick:r},{default:l(()=>[g("重置")]),_:1})])]),default:l(()=>[h("div",q,[e(b,null,{default:l(()=>[e(s,{label:"用户名"},{default:l(()=>[g(I(n.user.username),1)]),_:1}),e(s,{label:"权限"},{default:l(()=>[e(i,{modelValue:v.value,"onUpdate:modelValue":t[0]||(t[0]=U=>v.value=U),rows:2,props:w,options:a.value,"show-all-levels":!1},null,8,["modelValue","options"])]),_:1}),e(s)]),_:1})])]),_:1},8,["modelValue"])}}}),J={class:"user-ctrl-page"},K=h("div",{class:"page-header"},"用户管理",-1),Q={class:"option-row"},Z=x({__name:"UserCtrl",setup(k){V({username:"",name:"",phone:""});const y=V([]),u=T(),m=async()=>{const r=(await O()).data.filter(o=>!o.permission.isAdmin);y.value=r};m();const f=()=>{u.push({path:"/admin/create-user"})},w=E({visible:!1,data:{}}),a=async p=>{try{console.log(p.id),await L(p.id),await m(),B.success("删除成功")}catch{}},_=E({visible:!1,data:null}),v=p=>{_.visible=!0,_.data=p};return(p,r)=>{const o=d("el-divider"),n=d("el-button"),t=d("el-table-column"),s=d("el-table");return $(),S("div",J,[K,e(o),h("div",Q,[e(n,{type:"primary",onClick:f},{default:l(()=>[g("新建用户")]),_:1})]),e(s,{data:y.value,style:{width:"100%"}},{default:l(()=>[e(t,{prop:"username",label:"账号"}),e(t,{prop:"contact",label:"联系电话"}),e(t,{prop:"address",label:"地址"}),e(t,{label:"操作",width:"280"},{default:l(i=>[e(n,{size:"small",onClick:b=>v(i.row)},{default:l(()=>[g("授权管理")]),_:2},1032,["onClick"]),e(n,{size:"small",type:"danger",onClick:b=>a(i.row)},{default:l(()=>[g("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(R,{visible:w.visible,"onUpdate:visible":r[0]||(r[0]=i=>w.visible=i),user:w.data},null,8,["visible","user"]),e(G,{visible:_.visible,"onUpdate:visible":r[1]||(r[1]=i=>_.visible=i),user:_.data,onSuccess:m},null,8,["visible","user"])])}}});export{Z as default};
