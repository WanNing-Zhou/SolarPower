import{d as I,r as m,o as k,w as N,c as U,a as r,u as C,b as l,e as L,f as a,g as p,h as f,s as q,E as g,p as B,i as E,_ as M}from"./index-614b9659.js";import{l as P,g as R}from"./user-c451a6b7.js";const J=u=>(B("data-v-edac56a0"),u=u(),E(),u),O={class:"form-box",style:{width:"30%"}},T=J(()=>p("h1",{style:{color:"aliceblue","margin-bottom":"30px"}},"分布式光伏电站发电量检测管理系统",-1)),$={class:"flex"},z=I({__name:"LoginPage",setup(u){const w=m(!1),c=m(!1),o=m({username:"",password:"",repassword:""});k(()=>{const t=localStorage.getItem("acc-form");if(t){c.value=!0;const e=JSON.parse(t);o.value.username=e.username,o.value.password=atob(e.password)}});const i=m(),v={username:[{required:!0,message:"用户名不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"},{pattern:/^\S{5,32}$/,message:"密码必须是5-32位的非空字符",trigger:"blur"}],repassword:[{required:!0,message:"密码不能为空",trigger:"blur"},{pattern:/^\S{5,15}$/,message:"密码必须是5-15位的非空字符",trigger:"blur"},{validator:(t,e)=>{t!==o.value.password?e(new Error("两次输入的密码不一致")):e()},trigger:"blur"}]},_=C(),b=async()=>{var t;if(c.value){const e=JSON.stringify({password:btoa(o.value.password),username:o.value.username});localStorage.setItem("acc-form",e)}else localStorage.removeItem("acc-form");try{await i.value.validate();const e=await P({username:o.value.username,password:o.value.password});e.data&&q(e.data);const s=await R();console.log(s);const{isAdmin:d}=(t=s==null?void 0:s.data)==null?void 0:t.permission;d?_.push("/admin"):_.push("/home"),g.success("登录成功")}catch(e){g.error(e)}};return N(w,()=>{o.value={username:"",password:"",repassword:""}}),(t,e)=>{const s=l("el-form-item"),d=l("el-input"),x=l("el-checkbox"),h=l("el-button"),V=l("el-form"),y=l("el-col"),S=l("el-row");return L(),U(S,{class:"login-page"},{default:r(()=>[a(y,{span:24,class:"form"},{default:r(()=>[p("div",O,[a(V,{ref_key:"form",ref:i,model:o.value,rules:v,size:"large",autocomplete:"off"},{default:r(()=>[a(s,null,{default:r(()=>[T]),_:1}),a(s,{prop:"username"},{default:r(()=>[a(d,{"prefix-icon":"User",modelValue:o.value.username,"onUpdate:modelValue":e[0]||(e[0]=n=>o.value.username=n),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),a(s,{prop:"password"},{default:r(()=>[a(d,{name:"password","prefix-icon":"Lock",type:"password",modelValue:o.value.password,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.password=n),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),a(s,{class:"flex"},{default:r(()=>[p("div",$,[a(x,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=n=>c.value=n)},{default:r(()=>[f("记住我")]),_:1},8,["modelValue"])])]),_:1}),a(s,null,{default:r(()=>[a(h,{class:"button",type:"primary",onClick:b,"auto-insert-space":""},{default:r(()=>[f("登录")]),_:1})]),_:1}),a(s,{class:"flex"})]),_:1},8,["model"])])]),_:1})]),_:1})}}});const D=M(z,[["__scopeId","data-v-edac56a0"]]);export{D as default};
