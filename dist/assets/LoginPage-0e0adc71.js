import{d as C,r as m,o as N,w as U,c as L,a as t,u as q,b as l,e as B,f as s,g as p,h as f,s as E,E as g,p as M,i as P,_ as R}from"./index-4243db9d.js";import{l as J,g as O}from"./user-5209be3f.js";const w=u=>(M("data-v-41fde26e"),u=u(),P(),u),T=w(()=>p("h1",{style:{color:"aliceblue"}},"分布式光伏电站发电量检测管理系统",-1)),$=w(()=>p("h1",null,"登录",-1)),z={class:"flex"},A=C({__name:"LoginPage",setup(u){const v=m(!1),d=m(!1),o=m({username:"",password:"",repassword:""});N(()=>{const r=localStorage.getItem("acc-form");if(r){d.value=!0;const e=JSON.parse(r);o.value.username=e.username,o.value.password=atob(e.password)}});const i=m(),b={username:[{required:!0,message:"用户名不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"},{pattern:/^\S{5,15}$/,message:"密码必须是5-15位的非空字符",trigger:"blur"}],repassword:[{required:!0,message:"密码不能为空",trigger:"blur"},{pattern:/^\S{5,15}$/,message:"密码必须是5-15位的非空字符",trigger:"blur"},{validator:(r,e)=>{r!==o.value.password?e(new Error("两次输入的密码不一致")):e()},trigger:"blur"}]},_=q(),h=async()=>{var r;if(d.value){const e=JSON.stringify({password:btoa(o.value.password),username:o.value.username});localStorage.setItem("acc-form",e)}else localStorage.removeItem("acc-form");try{await i.value.validate();const e=await J({username:o.value.username,password:o.value.password});e.data&&E(e.data);const a=await O();console.log(a);const{isAdmin:c}=(r=a==null?void 0:a.data)==null?void 0:r.permission;c?_.push("/admin"):_.push("/home"),g.success("登录成功")}catch(e){g.error(e)}},x=r=>{console.log("remember",r),r=!0};return U(v,()=>{o.value={username:"",password:"",repassword:""}}),(r,e)=>{const a=l("el-form-item"),c=l("el-input"),V=l("el-checkbox"),y=l("el-button"),S=l("el-form"),I=l("el-col"),k=l("el-row");return B(),L(k,{class:"login-page"},{default:t(()=>[s(I,{span:24,class:"form"},{default:t(()=>[s(S,{ref_key:"form",ref:i,model:o.value,rules:b,size:"large",autocomplete:"off",style:{width:"30%"}},{default:t(()=>[s(a,null,{default:t(()=>[T]),_:1}),s(a,null,{default:t(()=>[$]),_:1}),s(a,{prop:"username"},{default:t(()=>[s(c,{"prefix-icon":"User",modelValue:o.value.username,"onUpdate:modelValue":e[0]||(e[0]=n=>o.value.username=n),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1}),s(a,{prop:"password"},{default:t(()=>[s(c,{name:"password","prefix-icon":"Lock",type:"password",modelValue:o.value.password,"onUpdate:modelValue":e[1]||(e[1]=n=>o.value.password=n),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),s(a,{class:"flex"},{default:t(()=>[p("div",z,[s(V,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=n=>d.value=n),onChange:x},{default:t(()=>[f("记住我")]),_:1},8,["modelValue"])])]),_:1}),s(a,null,{default:t(()=>[s(y,{class:"button",type:"primary",onClick:h,"auto-insert-space":""},{default:t(()=>[f("登录")]),_:1})]),_:1}),s(a,{class:"flex"})]),_:1},8,["model"])]),_:1})]),_:1})}}});const D=R(A,[["__scopeId","data-v-41fde26e"]]);export{D as default};
